"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"WepinFetch",{enumerable:!0,get:function(){return l}});var e=require("@wepin/common"),t=c(require("@wepin/fetch-js/package.json")),n=c(require("@wepin/storage-js")),r=c(require("./api/firebaseAuth/FirebaseAuthAPI.js")),i=c(require("./api/wepin/WepinSdkAPI.js"));function a(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){a(o,r,i,s,u,"next",e)}function u(e){a(o,r,i,s,u,"throw",e)}s(void 0)})}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){return e&&e.__esModule?e:{default:e}}function p(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var l=function(){"use strict";var a,c;function l(e){var r=e.appId,i=e.appKey,a=e.domain,o=e.sdk,s=e.storage;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,l),u(this,"version",void 0),u(this,"appId",void 0),u(this,"sdk",void 0),u(this,"_appKey",void 0),u(this,"_isInitialized",void 0),u(this,"_token",void 0),u(this,"_domain",void 0),u(this,"_wepinStorage",void 0),u(this,"wepinApi",void 0),u(this,"wepinFirebaseApi",void 0),this.version=t.default.version,this.appId=r,this._appKey=i,this._domain=a,this._token=void 0,this.sdk=o,this._wepinStorage=null!=s?s:new n.default}return a=[{key:"init",value:function(){var t=this;return o(function(){var n;return p(this,function(a){switch(a.label){case 0:return[4,l.getFirebaseConfig(t._appKey,t.sdk.type,t.sdk.version)];case 1:return n=a.sent(),t.wepinFirebaseApi=new r.default(n),t.wepinApi=new i.default((0,e.getUrlsByMode)((0,e.getModeByAppKey)(t._appKey)).sdkBackend,{appId:t.appId,appKey:t._appKey,domain:t._domain,sdk:t.sdk,wepinFetch:t}),t._isInitialized=!0,[2]}})})()}},{key:"isInitialized",value:function(){return this._isInitialized}},{key:"Token",value:function(){var e=this;return o(function(){return p(this,function(t){switch(t.label){case 0:return[4,e._wepinStorage.getLocalStorage(e.appId,"wepin:connectUser")];case 1:return e._token=t.sent(),[2,e._token]}})})()}},{key:"setToken",value:function(e){var t=this;return o(function(){return p(this,function(n){switch(n.label){case 0:if(t._token=e,!e)return[3,2];return[4,t._wepinStorage.setLocalStorage(t.appId,"wepin:connectUser",e)];case 1:return n.sent(),[3,4];case 2:return[4,t._wepinStorage.clearLocalStorage(t.appId,"wepin:connectUser")];case 3:n.sent(),n.label=4;case 4:return[2]}})})()}}],c=[{key:"getFirebaseConfig",value:function(t,n,r){return o(function(){var i;return p(this,function(a){switch(a.label){case 0:return i=(0,e.getUrlsByMode)((0,e.getModeByAppKey)(t)).sdkBackend,[4,fetch("".concat(i,"/user/firebase-config"),{method:"GET",headers:{"X-API-KEY":t,"X-SDK-TYPE":n,"X-SDK-VERSION":r,"Content-Type":"application/json"}})];case 1:return[4,a.sent().text()];case 2:return[2,JSON.parse(atob(a.sent()))]}})})()}}],a&&s(l.prototype,a),c&&s(l,c),l}();