var e,r,n,t;function s(e,r,n,t,s,o,a){try{var u=e[o](a),c=u.value}catch(e){n(e);return}u.done?r(c):Promise.resolve(c).then(t,s)}function o(e){return function(){var r=this,n=arguments;return new Promise(function(t,o){var a=e.apply(r,n);function u(e){s(a,t,o,u,c,"next",e)}function c(e){s(a,t,o,u,c,"throw",e)}u(void 0)})}}function a(e,r){var n,t,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,t&&(s=2&o[0]?t.return:o[0]?t.throw||((s=t.return)&&s.call(t),0):t.next)&&!(s=s.call(t,o[1])).done)return s;switch(t=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,t=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=r.call(e,a)}catch(e){o=[6,e],t=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}import{isErrorResponse as u,isFirebaseErrorResponse as c}from"@wepin/fetch-js";export var refreshFirebaseToken=(e=o(function(e,r,n,t){var s,o;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,5]),[4,r.wepinFirebaseApi.getRefreshIdToken(t.token.refreshToken)];case 1:if(c(s=a.sent()))return[2,!1];return o={provider:t.provider,idToken:s,refreshToken:t.token.refreshToken},[4,n.setLocalStorage(e,"firebase:wepin",o)];case 2:return a.sent(),[2,!0];case 3:return a.sent(),r.setToken(),[4,n.clearAllLocalStorage(e)];case 4:return a.sent(),[2,!1];case 5:return[2]}})}),function(r,n,t,s){return e.apply(this,arguments)});export var checkExistFirebaseLoginSession=(r=o(function(e,r,n){var t,s,o;return a(this,function(a){switch(a.label){case 0:return[4,n.getLocalStorage(e,"firebase:wepin")];case 1:if(!(null!=(t=a.sent())))return[3,8];a.label=2;case 2:return a.trys.push([2,5,,7]),[4,r.wepinFirebaseApi.getRefreshIdToken(t.refreshToken)];case 3:if(c(s=a.sent()))return[2,!1];return o={provider:t.provider,idToken:s,refreshToken:t.refreshToken},[4,n.setLocalStorage(e,"firebase:wepin",o)];case 4:return a.sent(),[2,!0];case 5:return a.sent(),r.setToken(),[4,n.clearAllLocalStorage(e)];case 6:case 9:return a.sent(),[2,!1];case 7:return[3,10];case 8:return r.setToken(),[4,n.clearAllLocalStorage(e)];case 10:return[2]}})}),function(e,n,t){return r.apply(this,arguments)});export var checkExistWepinLoginSession=(n=o(function(e,r,n){var t,s,o,c;return a(this,function(a){switch(a.label){case 0:return[4,n.getLocalStorage(e,"wepin:connectUser")];case 1:return t=a.sent(),[4,n.getLocalStorage(e,"user_id")];case 2:if(s=a.sent(),!(null!=t&&null!=s))return[3,9];r.setToken(t),a.label=3;case 3:return a.trys.push([3,6,,8]),[4,r.wepinApi.user.refreshToken({userId:s})];case 4:if(u(o=a.sent()))return[2,!1];return c={accessToken:o.token,refreshToken:t.refreshToken},[4,n.setLocalStorage(e,"wepin:connectUser",c)];case 5:return a.sent(),r.setToken(c),[2,!0];case 6:return a.sent(),r.setToken(),[4,n.clearAllLocalStorage(e)];case 7:case 10:return a.sent(),[2,!1];case 8:return[3,11];case 9:return r.setToken(),[4,n.clearAllLocalStorage(e)];case 11:return[2]}})}),function(e,r,t){return n.apply(this,arguments)});export var getLoginUserStorage=(t=o(function(e,r){var n,t,s,o,u;return a(this,function(a){switch(a.label){case 0:return[4,r.getAllLocalStorage(e)];case 1:if(!(n=a.sent())||(t=n.wallet_id,s=n.user_info,o=n["wepin:connectUser"],u=n.user_status,!s||!o||!u))return[2,null];return[2,{status:"success",userInfo:{userId:s.userInfo.userId,email:s.userInfo.email,provider:s.userInfo.provider,use2FA:s.userInfo.use2FA},userStatus:u,walletId:t,token:o}]}})}),function(e,r){return t.apply(this,arguments)});