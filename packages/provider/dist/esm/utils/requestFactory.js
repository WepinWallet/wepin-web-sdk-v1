function e(e,r,t,n,o,a,u){try{var i=e[a](u),l=i.value}catch(e){t(e);return}i.done?r(l):Promise.resolve(l).then(n,o)}import{ethErrors as r}from"eth-rpc-errors";import{setSelectedAddress as t}from"./selectedAddress.js";export var makeRequestID=function(){return new Date().getTime()};export var requestFactory=function(n){var o,a,u,i=n.wepinProvider,l=n.network,s=(n.req,n.res),c=(n.next,n.end),d=n.command,p=n.parameter,f=makeRequestID();i.webviewEventHandler.addResponseHandler(f.toString(),(o=function(e){var n,o;return function(e,r){var t,n,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(t)throw TypeError("Generator is already executing.");for(;u;)try{if(t=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,n=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=r.call(e,u)}catch(e){a=[6,e],n=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}(this,function(a){switch(a.label){case 0:if("User Cancel"!==e.body.data)return[3,1];return i.queue.shift(),c(r.provider.userRejectedRequest()),[3,5];case 1:if("ERROR"!==e.body.state)return[3,2];return i.queue.shift(),c(e.body.data),[3,5];case 2:if(s.result=e.body.data,"request_enable"!==e.body.command)return[3,4];return o=null===(n=s.result)||void 0===n?void 0:n[0],[4,t(i.wepinStorage,i.wepinAppId,l,o)];case 3:a.sent(),a.label=4;case 4:"wallet_switchEthereumChain"===e.body.command&&(s.result.rpcUrl=JSON.parse(s.result.rpcUrl),s.result.wepinProvider=i),c(),a.label=5;case 5:return[2]}})},a=function(){var r=this,t=arguments;return new Promise(function(n,a){var u=o.apply(r,t);function i(r){e(u,n,a,i,l,"next",r)}function l(r){e(u,n,a,i,l,"throw",r)}i(void 0)})},function(e){return a.apply(this,arguments)}),!0);try{i.queue.push({header:{request_from:"web",request_to:"wepin_widget",id:f},body:{command:d,parameter:p}}),(null===(u=i.wepinWidget)||void 0===u?void 0:u.isOpen)||i.openModal().catch(function(e){c(e)})}catch(e){c(e)}};