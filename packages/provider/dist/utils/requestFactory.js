function e(e,r,t,n,o,a,i){try{var u=e[a](i),l=u.value}catch(e){t(e);return}u.done?r(l):Promise.resolve(l).then(n,o)}import{ethErrors as r}from"eth-rpc-errors";import{setSelectedAddress as t}from"./selectedAddress";export var makeRequestID=function(){return new Date().getTime()};export var requestFactory=function(n){var o,a,i,u=n.wepinProvider,l=n.network,c=(n.req,n.res),s=(n.next,n.end),d=n.command,p=n.parameter,f=makeRequestID();u.webviewEventHandler.addResponseHandler(f.toString(),(o=function(e){var n,o;return function(e,r){var t,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw TypeError("Generator is already executing.");for(;i;)try{if(t=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=r.call(e,i)}catch(e){a=[6,e],n=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,function(a){switch(a.label){case 0:if("User Cancel"!==e.body.data)return[3,1];return u.queue.shift(),s(r.provider.userRejectedRequest()),[3,4];case 1:if(c.result="User Cancel"===e.body.data?"":e.body.data,"request_enable"!==e.body.command)return[3,3];return o=null===(n=c.result)||void 0===n?void 0:n[0],[4,t(u.wepinStorage,u.wepinAppId,l,o)];case 2:a.sent(),a.label=3;case 3:"wallet_switchEthereumChain"===e.body.command&&(c.result.rpcUrl=JSON.parse(c.result.rpcUrl),c.result.wepinProvider=u),s(),a.label=4;case 4:return[2]}})},a=function(){var r=this,t=arguments;return new Promise(function(n,a){var i=o.apply(r,t);function u(r){e(i,n,a,u,l,"next",r)}function l(r){e(i,n,a,u,l,"throw",r)}u(void 0)})},function(e){return a.apply(this,arguments)}),!0);try{u.queue.push({header:{request_from:"web",request_to:"wepin_widget",id:f},body:{command:d,parameter:p}}),(null===(i=u.wepinWidget)||void 0===i?void 0:i.isOpen)||u.openModal().catch(function(e){s(e)})}catch(e){s(e)}};